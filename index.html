<!DOCTYPE html>

<html lang="en" data-theme="rock">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff0000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="RAF TOUR">
    <link rel="apple-touch-icon" href="icon-180.png">
    <title>RAF - THE FINAL SEND-OFF TOUR | Amsterdam 2026</title>
    <meta name="description" content="Raf's Final Send-Off Tour ‚Äî Amsterdam, March 6-8, 2026. The crew. The chaos. The memories.">
    <meta property="og:title" content="RAF ‚Äî THE FINAL SEND-OFF TOUR">
    <meta property="og:description" content="Amsterdam ‚Ä¢ March 6-8, 2026 ‚Ä¢ The stag do of the decade.">
    <meta property="og:image" content="https://rafstag.com/raf_viking.png">
    <meta property="og:url" content="https://rafstag.com">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Parental Advisory Banner (Rock theme) -->
    <div class="advisory-banner" id="advisoryBanner">
        <div class="advisory-label">PARENTAL ADVISORY</div>
        <div class="advisory-text">EXPLICIT CONTENT</div>
    </div>

<!-- Corporate Banner (hidden by default) -->

<div class="corporate-banner" id="corporateBanner">
    <div class="corporate-banner-text">J.P. MORGAN &mdash; CONFIDENTIAL &mdash; FOR INTERNAL USE ONLY</div>
</div>

<!-- Theme Toggle Button -->

<button class="theme-toggle" id="themeToggle" title="Toggle Theme">
    <span class="toggle-icon rock-icon">üé∏</span>
    <span class="toggle-icon corp-icon">üíº</span>
</button>

<!-- WhatsApp Group Chat Float -->

<a href="https://chat.whatsapp.com/FA7SSTCp6rc0Yq2JHGkPKU?mode=gi_t" target="_blank" class="whatsapp-float" id="whatsappFloat" title="Group Chat">
    <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
    </svg>
</a>

<!-- Navigation -->

<nav class="main-nav">
    <div class="nav-container">
        <div class="logo" id="navLogo">RAF TOUR 2026</div>
        <ul class="nav-links">
            <li><a href="#home">HOME</a></li>
            <li><a href="#lineup">THE LINEUP</a></li>
            <li><a href="#tour-dates">TOUR DATES</a></li>
            <li><a href="#setlist">SETLIST</a></li>
            <li><a href="#vote">VOTE</a></li>
            <li><a href="#gallery">BACKSTAGE</a></li>
            <li><a href="#rules">TOUR RULES</a></li>
        </ul>
    </div>
</nav>

<!-- Hero Section -->

<section id="home" class="hero">
    <div class="hero-content">
        <img src="raf_viking.png" alt="RAF - The Final Send-Off Tour" class="hero-image">
        <div class="hero-text">
            <h1 class="glitch" data-text="THE FINAL SEND-OFF TOUR" id="heroTitle">THE FINAL SEND-OFF TOUR</h1>
            <h2 id="heroSubtitle">AMSTERDAM ‚Ä¢ MARCH 6-8, 2026</h2>
            <div class="countdown" id="countdown">
                <div class="countdown-item">
                    <span class="countdown-value" id="days">00</span>
                    <span class="countdown-label">DAYS</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-value" id="hours">00</span>
                    <span class="countdown-label">HOURS</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-value" id="minutes">00</span>
                    <span class="countdown-label">MINS</span>
                </div>
                <div class="countdown-item">
                    <span class="countdown-value" id="seconds">00</span>
                    <span class="countdown-label">SECS</span>
                </div>
            </div>
        </div>
    </div>
    <div class="scroll-indicator">SCROLL FOR MORE ‚ñº</div>
    <div id="confettiContainer"></div>
</section>

<!-- The Lineup Section -->

<section id="lineup" class="lineup-section">
    <h2 class="section-title">THE LINEUP</h2>
    <div class="section-subtitle">THE WARRIORS RIDING INTO BATTLE</div>
    <div class="lineup-grid">
        <div class="lineup-card headliner">
            <img src="Raf2.PNG" alt="Raf">
            <div class="lineup-name">RAF</div>
            <div class="lineup-role">HEADLINER ‚Ä¢ THE GROOM</div>
            <div class="lineup-bio">"One last ride before the ball and chain"</div>
        </div>
        <div class="lineup-card">
            <img src="Julien.PNG" alt="Julien">
            <div class="lineup-name">JULIEN</div>
            <div class="lineup-role">BEST MAN ‚Ä¢ TALL FRENCH GUY</div>
        </div>
        <div class="lineup-card">
            <img src="Stam.PNG" alt="Stam" id="stamImg">
            <div class="lineup-name">STAM</div>
            <div class="lineup-role">THE DUTCH GUY &bull; TALL</div>
            <button class="stam-toggle" id="stamToggle" onclick="toggleStam()">üí™ TOGGLE ARMS</button>
        </div>
        <div class="lineup-card">
            <img src="Antoine.PNG" alt="Antoine">
            <div class="lineup-name">ANTOINE</div>
            <div class="lineup-role">TALL FRENCH GUY</div>
        </div>
        <div class="lineup-card">
            <img src="Seymon.PNG" alt="Seymon">
            <div class="lineup-name">SEYMON</div>
            <div class="lineup-role">THE BOSS</div>
        </div>
        <div class="lineup-card">
            <img src="Pretesh.PNG" alt="Pretesh">
            <div class="lineup-name">PRETESH</div>
            <div class="lineup-role">THE SHORT GUY</div>
        </div>
        <div class="lineup-card">
            <img src="Venkat.PNG" alt="Venkat">
            <div class="lineup-name">VENKAT</div>
            <div class="lineup-role">THE TECH GUY</div>
        </div>
        <div class="lineup-card">
            <img src="Evgeni.PNG" alt="Evgeni">
            <div class="lineup-name">EVGENI</div>
            <div class="lineup-role">THE DARK HORSE</div>
        </div>
        <div class="lineup-card">
            <img src="Daniel.PNG" alt="Daniel">
            <div class="lineup-name">DAN</div>
            <div class="lineup-role">THE CHAOS AGENT</div>
        </div>
        <div class="lineup-card">
            <img src="Dave.PNG" alt="Dave">
            <div class="lineup-name">DAVE</div>
            <div class="lineup-role">LANKY</div>
        </div>
    </div>
</section>

<!-- Tour Dates / Itinerary -->

<section id="tour-dates" class="tour-dates-section">
    <h2 class="section-title">TOUR DATES</h2>
    <div class="section-subtitle">3 NIGHTS OF CHAOS</div>
    <div class="tour-schedule">
        <div class="tour-day">
            <div class="day-header">
                <div class="day-number">DAY 1</div>
                <div class="day-date">FRIDAY, MARCH 6</div>
            </div>
            <div class="day-events">
                <div class="event">
                    <div class="event-time">15:30</div>
                    <div class="event-details">
                        <div class="event-name">LEAVE CANARY WHARF</div>
                        <div class="event-location">üìç DLR to London City Airport</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">17:05</div>
                    <div class="event-details">
                        <div class="event-name">WHEELS UP</div>
                        <div class="event-location">üìç BA8459 departs London City</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">19:15</div>
                    <div class="event-details">
                        <div class="event-name">TOUCHDOWN AMSTERDAM</div>
                        <div class="event-location">üìç Schiphol Airport</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">20:30</div>
                    <div class="event-details">
                        <div class="event-name">HOTEL CHECK-IN</div>
                        <div class="event-location">üìç <a href="https://www.google.com/maps/search/?api=1&query=NH+Amsterdam+Leidseplein+Stadhouderskade+7+Amsterdam" target="_blank" style="color: inherit; text-decoration: underline;">NH Amsterdam Leidseplein</a><br>Stadhouderskade 7, 1054 ES Amsterdam</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">21:30</div>
                    <div class="event-details">
                        <div class="event-name">FIRST PINTS & DINNER</div>
                        <div class="event-location">üìç Leidseplein Area</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">00:00</div>
                    <div class="event-details">
                        <div class="event-name">LATE NIGHT EXPLORATION</div>
                        <div class="event-location">üìç You know where...</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tour-day">
            <div class="day-header">
                <div class="day-number">DAY 2</div>
                <div class="day-date">SATURDAY, MARCH 7</div>
            </div>
            <div class="day-events">
                <div class="event">
                    <div class="event-time">10:00</div>
                    <div class="event-details">
                        <div class="event-name">RECOVERY BREAKFAST</div>
                        <div class="event-location">üìç Hotel</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">13:00</div>
                    <div class="event-details">
                        <div class="event-name">ACTIVITY TBC</div>
                        <div class="event-location">üìç Shooting Range / Go-Karts / Beer Bikes?</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">18:00</div>
                    <div class="event-details">
                        <div class="event-name">PUB CRAWL BEGINS</div>
                        <div class="event-location">üìç Leidseplein Area</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">23:00</div>
                    <div class="event-details">
                        <div class="event-name">CLUB NIGHT</div>
                        <div class="event-location">üìç Paradiso / Melkweg TBC</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tour-day">
            <div class="day-header">
                <div class="day-number">DAY 3</div>
                <div class="day-date">SUNDAY, MARCH 8</div>
            </div>
            <div class="day-events">
                <div class="event">
                    <div class="event-time">10:00</div>
                    <div class="event-details">
                        <div class="event-name">RECOVERY BRUNCH</div>
                        <div class="event-location">üìç Hotel / Local Spot</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">12:00</div>
                    <div class="event-details">
                        <div class="event-name">HOTEL CHECKOUT</div>
                        <div class="event-location">üìç <a href="https://www.google.com/maps/search/?api=1&query=NH+Amsterdam+Leidseplein+Stadhouderskade+7+Amsterdam" target="_blank" style="color: inherit; text-decoration: underline;">NH Amsterdam Leidseplein</a></div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">14:00</div>
                    <div class="event-details">
                        <div class="event-name">DEPARTURE TO AIRPORT</div>
                        <div class="event-location">üìç Amsterdam Schiphol</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">16:10</div>
                    <div class="event-details">
                        <div class="event-name">FLIGHT HOME</div>
                        <div class="event-location">üìç BA0439 to London City</div>
                    </div>
                </div>
                <div class="event">
                    <div class="event-time">‚àû</div>
                    <div class="event-details">
                        <div class="event-name">MEMORIES FOREVER</div>
                        <div class="event-location">üìç In our hearts (and photos)</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Setlist / Activities -->

<section id="setlist" class="setlist-section">
    <h2 class="section-title">THE SETLIST</h2>
    <div class="section-subtitle">GREATEST HITS</div>
    <div class="setlist">
        <div class="setlist-item">
            <span class="track-number">01</span>
            <span class="track-name">Canal Cruise & Beers</span>
            <span class="track-duration">üç∫üç∫üç∫</span>
        </div>
        <div class="setlist-item">
            <span class="track-number">02</span>
            <span class="track-name">Heineken Experience</span>
            <span class="track-duration">üç∫üç∫üç∫</span>
        </div>
        <div class="setlist-item">
            <span class="track-number">03</span>
            <span class="track-name">Coffee Shop Tour (Educational)</span>
            <span class="track-duration">üåøüåøüåø</span>
        </div>
        <div class="setlist-item">
            <span class="track-number">04</span>
            <span class="track-name">Red Light District</span>
            <span class="track-duration">üî¥üî¥üî¥</span>
        </div>
        <div class="setlist-item">
            <span class="track-number">05</span>
            <span class="track-name">Dam Square Mayhem</span>
            <span class="track-duration">üéâüéâüéâ</span>
        </div>
        <div class="setlist-item">
            <span class="track-number">06</span>
            <span class="track-name">Stag Costume Reveal</span>
            <span class="track-duration">üëëüëëüëë</span>
        </div>
        <div class="setlist-item">
            <span class="track-number">07</span>
            <span class="track-name">Epic Night Out</span>
            <span class="track-duration">üî•üî•üî•</span>
        </div>
        <div class="setlist-item encore">
            <span class="track-number">ENCORE</span>
            <span class="track-name">3AM Kebabs & Regrets</span>
            <span class="track-duration">üåØüíÄ</span>
        </div>
    </div>
</section>

<!-- ===== VOTE SECTION ===== -->

<section id="vote" class="voting-section">
    <h2 class="section-title">THE VOTE</h2>
    <div class="section-subtitle" id="voteSubtitle">SUGGEST & VOTE ON ACTIVITIES / PLACES</div>

<!-- Who are you? -->
<div class="voter-identity">
    <label>WHO ARE YOU?</label>
    <select id="voterSelect">
        <option value="">‚Äî SELECT YOUR NAME ‚Äî</option>
        <option value="Raf">RAF</option>
        <option value="Julien">JULIEN</option>
        <option value="Stam">STAM</option>
        <option value="Antoine">ANTOINE</option>
        <option value="Seymon">SEYMON</option>
        <option value="Pretesh">PRETESH</option>
        <option value="Venkat">VENKAT</option>
        <option value="Evgeni">EVGENI</option>
        <option value="Dan">DAN</option>
        <option value="Dave">DAVE</option>
    </select>
    <div class="identity-note" id="identityNote">Select your name to suggest & vote</div>
</div>

<!-- Suggest form -->
<div class="suggest-form">
    <h3 id="suggestFormTitle">üé∏ PITCH YOUR IDEA</h3>
    <div class="suggest-row">
        <input type="text" class="suggest-title" id="suggestionTitle" placeholder="e.g. Heineken Experience, Go-Karts, Paradiso..." maxlength="80">
        <select class="suggest-cat" id="suggestionCat">
            <option value="activity">üéØ Activity</option>
            <option value="place">üç∫ Bar / Place</option>
            <option value="food">üçî Food</option>
            <option value="other">‚ö° Other</option>
        </select>
    </div>
    <textarea id="suggestionDesc" placeholder="Any details? (optional)" maxlength="200"></textarea>
    <div class="locked-notice" id="lockedNotice">‚ö† SELECT YOUR NAME ABOVE FIRST</div>
    <button class="suggest-btn" id="submitSuggestion">+ SUBMIT SUGGESTION</button>
</div>

<!-- Suggestions list -->
<div class="suggestions-container">
    <div class="suggestions-filter">
        <button class="filter-btn active" data-filter="all">ALL</button>
        <button class="filter-btn" data-filter="activity">ACTIVITIES</button>
        <button class="filter-btn" data-filter="place">BARS / PLACES</button>
        <button class="filter-btn" data-filter="food">FOOD</button>
        <button class="filter-btn" data-filter="other">OTHER</button>
    </div>
    <div id="suggestionsList">
        <div class="no-suggestions">NO SUGGESTIONS YET ‚Äî BE THE FIRST TO PITCH AN IDEA</div>
    </div>
</div>
</section>

<!-- Photo Gallery -->

<section id="gallery" class="gallery-section">
    <h2 class="section-title">BACKSTAGE PASS</h2>
    <div class="section-subtitle">UPLOAD YOUR PHOTOS FROM THE TOUR</div>
    <div class="upload-zone" id="uploadZone">
        <div class="upload-icon">üì∏</div>
        <div class="upload-text">Click or Drag Photos Here</div>
        <div class="upload-subtext">Share the chaos with the crew</div>
    </div>
    <div class="photo-grid" id="photoGrid"></div>
</section>

<!-- Lightbox -->

<div id="lightbox" class="lightbox">
    <button class="lightbox-close" id="lightboxClose">‚úï</button>
    <button class="lightbox-prev" id="lightboxPrev">&#8249;</button>
    <button class="lightbox-next" id="lightboxNext">&#8250;</button>
    <div class="lightbox-img-wrap">
        <img id="lightboxImg" src="" alt="">
    </div>
</div>

<!-- Tour Rules -->

<section id="rules" class="rules-section">
    <h2 class="section-title">TOUR RULES</h2>
    <div class="section-subtitle">BREAK THEM AT YOUR PERIL</div>
    <div class="rules-container">
        <div class="rule-card">
            <div class="rule-number">01</div>
            <div class="rule-text">What happens in Amsterdam, gets posted in the group chat</div>
        </div>
        <div class="rule-card">
            <div class="rule-number">02</div>
            <div class="rule-text">The groom drinks for free (or pays double, we'll decide)</div>
        </div>
        <div class="rule-card">
            <div class="rule-number">03</div>
            <div class="rule-text">No man left behind (unless he's being arrested)</div>
        </div>
        <div class="rule-card">
            <div class="rule-number">04</div>
            <div class="rule-text">Costume must be worn at all times on Day 2</div>
        </div>
        <div class="rule-card">
            <div class="rule-number">05</div>
            <div class="rule-text">Forfeit drinks for: mentioning the wedding, checking work emails, boring conversation</div>
        </div>
        <div class="rule-card">
            <div class="rule-number">06</div>
            <div class="rule-text">Photos or it didn't happen</div>
        </div>
        <div class="rule-card">
            <div class="rule-number">07</div>
            <div class="rule-text">Emergency contact: Don't call anyone, we're adults</div>
        </div>
        <div class="rule-card">
            <div class="rule-number">08</div>
            <div class="rule-text">What Raf says, goes. Except when he's too drunk to talk.</div>
        </div>
    </div>
</section>

<!-- Footer -->

<footer class="footer">
    <div class="footer-content">
        <div class="footer-logo" id="footerLogo">RAF ‚Ä¢ THE FINAL SEND-OFF TOUR</div>
        <div class="footer-text" id="footerText">AMSTERDAM ‚Ä¢ MARCH 6-8, 2026</div>
        <div class="footer-warning" id="footerWarning">‚ö†Ô∏è PARENTAL ADVISORY: EXPLICIT CONTENT ‚ö†Ô∏è</div>
        <div class="footer-links">
            <a href="#home">HOME</a>
            <a href="#lineup">LINEUP</a>
            <a href="#tour-dates">DATES</a>
            <a href="#vote">VOTE</a>
            <a href="#gallery">PHOTOS</a>
        </div>
    </div>
</footer>

<!-- Core site functionality -->

<script src="script.js"></script>

<!-- Lightbox -->

<script>
    (function() {
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        const closeBtn = document.getElementById('lightboxClose');
        const prevBtn = document.getElementById('lightboxPrev');
        const nextBtn = document.getElementById('lightboxNext');
        let currentIndex = 0;

        function getPhotos() {
            return [...document.querySelectorAll('.photo-item img')];
        }

        function openLightbox(index) {
            const photos = getPhotos();
            if (!photos.length) return;
            currentIndex = index;
            lightboxImg.src = photos[currentIndex].src;
            lightbox.classList.add('open');
        }

        function closeLightbox() {
            lightbox.classList.remove('open');
            lightboxImg.src = '';
        }

        function showPrev() {
            const photos = getPhotos();
            currentIndex = (currentIndex - 1 + photos.length) % photos.length;
            lightboxImg.src = photos[currentIndex].src;
        }

        function showNext() {
            const photos = getPhotos();
            currentIndex = (currentIndex + 1) % photos.length;
            lightboxImg.src = photos[currentIndex].src;
        }

        // Delegate clicks on photo grid (works for dynamically added photos)
        document.getElementById('photoGrid').addEventListener('click', function(e) {
            const img = e.target.closest('img');
            if (!img) return;
            const photos = getPhotos();
            const index = photos.indexOf(img);
            if (index !== -1) openLightbox(index);
        });

        closeBtn.addEventListener('click', closeLightbox);
        prevBtn.addEventListener('click', showPrev);
        nextBtn.addEventListener('click', showNext);

        // Close on background click
        lightbox.addEventListener('click', function(e) {
            if (e.target === lightbox) closeLightbox();
        });

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (!lightbox.classList.contains('open')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') showPrev();
            if (e.key === 'ArrowRight') showNext();
        });

        // Touch swipe support
        let touchStartX = 0;
        lightbox.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });
        lightbox.addEventListener('touchend', function(e) {
            const diff = touchStartX - e.changedTouches[0].screenX;
            if (Math.abs(diff) > 50) {
                if (diff > 0) showNext();
                else showPrev();
            }
        }, { passive: true });
    })();
</script>

<!-- Firebase SDK -->

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js';
    import {
        getFirestore, collection, addDoc, query, orderBy,
        onSnapshot, serverTimestamp, doc, updateDoc, arrayUnion, arrayRemove
    } from 'https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js';

    const app = initializeApp({
        apiKey: "AIzaSyBLh95u3yOVEAAehXQhTh3d-O73RZ5m41w",
        authDomain: "rafstag-33347.firebaseapp.com",
        projectId: "rafstag-33347",
        storageBucket: "rafstag-33347.firebasestorage.app",
        messagingSenderId: "750551283012",
        appId: "1:750551283012:web:d35c36693043ae4c92d311"
    });

    const db = getFirestore(app);

    // ===== PHOTO UPLOAD =====
    const photosRef   = collection(db, 'photos');
    const CLOUD_NAME  = 'dqugijser';
    const UPLOAD_PRESET = 'rafstag_photos';

    const uploadZone = document.getElementById('uploadZone');
    const photoGrid  = document.getElementById('photoGrid');
    const fileInput  = Object.assign(document.createElement('input'), {
        type: 'file', accept: 'image/*', multiple: true
    });
    fileInput.style.display = 'none';
    document.body.appendChild(fileInput);

    const rendered = new Set();

    uploadZone.addEventListener('click', () => fileInput.click());
    uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.style.background = 'rgba(255,0,0,0.2)'; });
    uploadZone.addEventListener('dragleave', e => { e.preventDefault(); uploadZone.style.background = ''; });
    uploadZone.addEventListener('drop', e => {
        e.preventDefault(); uploadZone.style.background = '';
        const imgs = [...e.dataTransfer.files].filter(f => f.type.startsWith('image/'));
        if (imgs.length) runUpload(imgs);
    });
    fileInput.addEventListener('change', e => { if (e.target.files.length) runUpload([...e.target.files]); fileInput.value = ''; });

    async function runUpload(files) {
        const saved = uploadZone.innerHTML;
        let done = 0;
        uploadZone.innerHTML = `<div class="upload-icon">‚è≥</div><div class="upload-text" id="uploadProgress">Uploading 0 / ${files.length}‚Ä¶</div>`;
        const prog = document.getElementById('uploadProgress');
        for (const f of files) {
            const url = await uploadToCloudinary(f);
            if (url) { done++; await addDoc(photosRef, { url, uploadedAt: serverTimestamp() }); }
            prog.textContent = `Uploading ${done} / ${files.length}‚Ä¶`;
        }
        uploadZone.innerHTML = saved;
        if (done) notify(`${done} photo${done > 1 ? 's' : ''} uploaded! üì∏`);
    }

    async function uploadToCloudinary(file) {
        const fd = new FormData();
        fd.append('file', file); fd.append('upload_preset', UPLOAD_PRESET); fd.append('tags', 'rafstag');
        try {
            const r = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`, { method: 'POST', body: fd });
            const d = await r.json();
            if (d.error) { alert('Upload failed: ' + d.error.message); return null; }
            return d.secure_url;
        } catch { alert('Upload failed ‚Äî check your connection.'); return null; }
    }

    onSnapshot(query(photosRef, orderBy('uploadedAt', 'desc')), snap => {
        snap.docChanges().forEach(ch => {
            if (ch.type === 'added' && ch.doc.data().url) addPhoto(ch.doc.data().url);
        });
        if (snap.empty && rendered.size === 0) {
            const p = document.createElement('p');
            p.className = 'gallery-msg';
            p.style.cssText = 'color:#888;text-align:center;width:100%;padding:40px 20px;';
            p.textContent = 'No photos yet. Be the first to upload!';
            photoGrid.appendChild(p);
        }
    });

    function addPhoto(url) {
        if (rendered.has(url)) return;
        rendered.add(url);
        photoGrid.querySelector('.gallery-msg')?.remove();
        const div = document.createElement('div');
        div.className = 'photo-item';
        div.innerHTML = `<img src="${url}" alt="Stag photo" loading="lazy">`;
        photoGrid.insertBefore(div, photoGrid.firstChild);
    }

    // ===== VOTING =====
    const suggestionsRef = collection(db, 'suggestions');

    let currentUser  = null;
    let currentFilter = 'all';
    let allDocs = {}; // id -> data

    const voterSelect     = document.getElementById('voterSelect');
    const submitBtn       = document.getElementById('submitSuggestion');
    const titleInput      = document.getElementById('suggestionTitle');
    const catSelect       = document.getElementById('suggestionCat');
    const descInput       = document.getElementById('suggestionDesc');
    const suggestionsList = document.getElementById('suggestionsList');
    const lockedNotice    = document.getElementById('lockedNotice');
    const identityNote    = document.getElementById('identityNote');
    const suggestFormTitle = document.getElementById('suggestFormTitle');
    const voteSubtitle    = document.getElementById('voteSubtitle');

    // Initial locked state
    lockedNotice.style.display = 'block';
    submitBtn.style.display = 'none';

    // Theme-aware copy
    function updateVoteCopy() {
        const corp = document.documentElement.getAttribute('data-theme') === 'corporate';
        suggestFormTitle.textContent = corp ? 'üìã SUBMIT A PROPOSAL' : 'üé∏ PITCH YOUR IDEA';
        voteSubtitle.textContent = corp
            ? 'SUBMIT & VOTE ON TEAM OFFSITE AGENDA ITEMS'
            : 'SUGGEST & VOTE ON ACTIVITIES / PLACES';
    }
    new MutationObserver(updateVoteCopy).observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });
    updateVoteCopy();

    // Name selection
    voterSelect.addEventListener('change', () => {
        currentUser = voterSelect.value || null;
        if (currentUser) {
            identityNote.textContent = `Voting as ${currentUser.toUpperCase()} ‚Äî one vote per suggestion`;
            lockedNotice.style.display = 'none';
            submitBtn.style.display = 'inline-block';
        } else {
            identityNote.textContent = 'Select your name to suggest & vote';
            lockedNotice.style.display = 'block';
            submitBtn.style.display = 'none';
        }
        render();
    });

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.dataset.filter;
            render();
        });
    });

    // Submit
    submitBtn.addEventListener('click', async () => {
        if (!currentUser) return;
        const title = titleInput.value.trim();
        if (!title) { titleInput.focus(); return; }

        submitBtn.textContent = 'SUBMITTING‚Ä¶';
        submitBtn.disabled = true;

        try {
            await addDoc(suggestionsRef, {
                title,
                category: catSelect.value,
                description: descInput.value.trim(),
                suggestedBy: currentUser,
                voters: [currentUser], // auto-upvote own idea
                createdAt: serverTimestamp()
            });
            titleInput.value = '';
            descInput.value = '';
            notify('Suggestion added! ü§ò');
        } catch (e) {
            console.error(e);
            alert('Failed to submit. Try again.');
        }

        submitBtn.textContent = '+ SUBMIT SUGGESTION';
        submitBtn.disabled = false;
    });

    // Real-time sync
    onSnapshot(suggestionsRef, snap => {
        allDocs = {};
        snap.forEach(d => { allDocs[d.id] = { id: d.id, ...d.data() }; });
        render();
    });

    function render() {
        suggestionsList.innerHTML = '';
        let items = Object.values(allDocs);
        if (currentFilter !== 'all') items = items.filter(s => s.category === currentFilter);
        items.sort((a, b) => (b.voters?.length || 0) - (a.voters?.length || 0));

        if (!items.length) {
            const el = document.createElement('div');
            el.className = 'no-suggestions';
            el.textContent = currentFilter === 'all'
                ? 'NO SUGGESTIONS YET ‚Äî BE THE FIRST TO PITCH AN IDEA'
                : 'NO SUGGESTIONS IN THIS CATEGORY YET';
            suggestionsList.appendChild(el);
            return;
        }

        items.forEach(s => suggestionsList.appendChild(buildCard(s)));
    }

    const CAT_LABELS = { activity: 'üéØ Activity', place: 'üç∫ Bar / Place', food: 'üçî Food', other: '‚ö° Other' };

    function buildCard(s) {
        const voters   = s.voters || [];
        const iVoted   = currentUser && voters.includes(currentUser);
        const card     = document.createElement('div');
        card.className = `suggestion-card cat-${s.category} ${iVoted ? 'voted-by-me' : ''}`;

        card.innerHTML = `
            <button class="vote-btn ${iVoted ? 'voted' : ''}">
                <span class="vote-arrow">‚ñ≤</span>
                <span class="vote-count">${voters.length}</span>
            </button>
            <div class="suggestion-content">
                <div class="suggestion-header">
                    <span class="suggestion-title">${esc(s.title)}</span>
                    <span class="suggestion-category">${CAT_LABELS[s.category] || s.category}</span>
                </div>
                ${s.description ? `<div class="suggestion-desc">${esc(s.description)}</div>` : ''}
                <div class="suggestion-meta">Suggested by ${s.suggestedBy || '?'}</div>
                ${voters.length ? `<div class="voters-list">üëç ${voters.join(', ')}</div>` : ''}
            </div>`;

        card.querySelector('.vote-btn').addEventListener('click', () => toggleVote(s.id, iVoted));
        return card;
    }

    async function toggleVote(id, iVoted) {
        if (!currentUser) { notify('Select your name first!'); voterSelect.focus(); return; }
        const ref = doc(db, 'suggestions', id);
        await updateDoc(ref, { voters: iVoted ? arrayRemove(currentUser) : arrayUnion(currentUser) });
    }

    function esc(s) {
        return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    function notify(msg) {
        if (typeof window.showNotification === 'function') { window.showNotification(msg); return; }
        const n = document.createElement('div');
        n.style.cssText = 'position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#ff0000;color:#fff;padding:14px 28px;border-radius:4px;font-family:Courier New,monospace;font-size:0.85rem;letter-spacing:2px;z-index:9999;pointer-events:none;';
        n.textContent = msg;
        document.body.appendChild(n);
        setTimeout(() => n.remove(), 3000);
    }
</script>


<script>
    let stamSkinny = false;
    function toggleStam() {
        const img = document.getElementById("stamImg");
        const btn = document.getElementById("stamToggle");
        stamSkinny = !stamSkinny;
        img.src = stamSkinny ? "Stam3.PNG" : "Stam.PNG";
        btn.textContent = stamSkinny ? "üí™ RESTORE GAINS" : "üí™ TOGGLE ARMS";
    }
</script>
</body>
</html>
