<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAF - THE FINAL SEND-OFF TOUR | Amsterdam 2026</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Parental Advisory Banner -->
    <div class="advisory-banner">
        <div class="advisory-label">PARENTAL ADVISORY</div>
        <div class="advisory-text">EXPLICIT CONTENT</div>
    </div>

    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <div class="logo">RAF TOUR 2026</div>
            <ul class="nav-links">
                <li><a href="#home">HOME</a></li>
                <li><a href="#lineup">THE LINEUP</a></li>
                <li><a href="#tour-dates">TOUR DATES</a></li>
                <li><a href="#setlist">SETLIST</a></li>
                <li><a href="#gallery">BACKSTAGE</a></li>
                <li><a href="#rules">TOUR RULES</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-content">
            <img src="raf_viking.png" alt="RAF - The Final Send-Off Tour" class="hero-image">
            <div class="hero-text">
                <h1 class="glitch" data-text="THE FINAL SEND-OFF TOUR">THE FINAL SEND-OFF TOUR</h1>
                <h2>AMSTERDAM ‚Ä¢ MARCH 6-8, 2026</h2>
                <div class="countdown" id="countdown">
                    <div class="countdown-item">
                        <span class="countdown-value" id="days">00</span>
                        <span class="countdown-label">DAYS</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-value" id="hours">00</span>
                        <span class="countdown-label">HOURS</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-value" id="minutes">00</span>
                        <span class="countdown-label">MINUTES</span>
                    </div>
                    <div class="countdown-item">
                        <span class="countdown-value" id="seconds">00</span>
                        <span class="countdown-label">SECONDS</span>
                    </div>
                </div>
                <div class="hero-subtitle">
                    <p>THE ULTIMATE SEND-OFF FOR A LEGEND</p>
                    <p class="venue">üìç LEIDSEPLEIN ‚Ä¢ AMSTERDAM</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Lineup Section -->
    <section id="lineup" class="lineup">
        <h2 class="section-title">THE LINEUP</h2>
        <div class="lineup-grid">
            <div class="member-card">
                <div class="member-photo">üëë</div>
                <h3>RAF</h3>
                <p>THE STAG KING</p>
            </div>
            <div class="member-card">
                <div class="member-photo">üé∏</div>
                <h3>THE BOYS</h3>
                <p>THE CREW</p>
            </div>
            <div class="member-card">
                <div class="member-photo">üçª</div>
                <h3>AMSTERDAM</h3>
                <p>THE BATTLEGROUND</p>
            </div>
        </div>
    </section>

    <!-- Tour Dates Section -->
    <section id="tour-dates" class="tour-dates">
        <h2 class="section-title">TOUR DATES</h2>
        <div class="dates-container">
            <div class="date-card">
                <div class="date">MARCH 6</div>
                <div class="event">ARRIVAL + WARM-UP</div>
                <div class="details">The calm before the storm</div>
            </div>
            <div class="date-card featured">
                <div class="date">MARCH 7</div>
                <div class="event">MAIN EVENT</div>
                <div class="details">The night Raf becomes immortal</div>
            </div>
            <div class="date-card">
                <div class="date">MARCH 8</div>
                <div class="event">RECOVERY DAY</div>
                <div class="details">Survivors only</div>
            </div>
        </div>
    </section>

    <!-- Setlist Section -->
    <section id="setlist" class="setlist">
        <h2 class="section-title">SETLIST</h2>
        <div class="setlist-container">
            <div class="song">1. "WELCOME TO AMSTERDAM" (Intro)</div>
            <div class="song">2. "RAF'S LAST RIDE"</div>
            <div class="song">3. "SHOTS FIRED"</div>
            <div class="song">4. "NO SLEEP TILL SUNDAY"</div>
            <div class="song">5. "LEGENDS NEVER DIE" (Encore)</div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="gallery">
        <h2 class="section-title">BACKSTAGE PHOTOS</h2>
        <div class="upload-container">
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">üì∏</div>
                <div class="upload-text">DROP YOUR EVIDENCE HERE</div>
                <div class="upload-subtext">Click to upload photos (max 10MB each)</div>
            </div>
        </div>

        <div class="photo-grid" id="photoGrid">
            <div class="loading">Loading photos...</div>
        </div>
    </section>

    <!-- Rules Section -->
    <section id="rules" class="rules">
        <h2 class="section-title">TOUR RULES</h2>
        <div class="rules-container">
            <div class="rule">üî• WHAT HAPPENS IN AMSTERDAM...</div>
            <div class="rule">üç∫ NO ONE GOES HOME SOBER</div>
            <div class="rule">üì± PHONES DOWN, MEMORIES UP</div>
            <div class="rule">üëë RAF IS KING FOR THE WEEKEND</div>
            <div class="rule">‚ö° LEGENDARY STORIES ONLY</div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2026 RAF FINAL SEND-OFF TOUR</p>
        <p class="sponsor">Sponsored by: Chaos, Beer, and Bad Decisions</p>
    </footer>

    <script>
        // Countdown Timer
        const targetDate = new Date('2026-03-06T15:00:00Z').getTime();

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate - now;

            if (distance < 0) {
                document.getElementById('countdown').innerHTML = '<div class="countdown-ended">THE TOUR HAS BEGUN!</div>';
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('days').textContent = String(days).padStart(2, '0');
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
        }

        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>

    <script>
        // Cloudinary Configuration
        const CLOUD_NAME = 'dqugijser';
        const UPLOAD_PRESET = 'rafstag_photos';

        document.addEventListener('DOMContentLoaded', function() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.multiple = true;
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);

            // Upload zone click handler
            uploadZone.addEventListener('click', () => {
                fileInput.click();
            });

            // File selection handler
            fileInput.addEventListener('change', async (e) => {
                const files = Array.from(e.target.files);
                const uploadZone = document.getElementById('uploadZone');

                // Show uploading message
                const originalHTML = uploadZone.innerHTML;
                uploadZone.innerHTML = `
                    <div class="upload-icon">‚è≥</div>
                    <div class="upload-text">Uploading...</div>
                `;

                for (const file of files) {
                    await uploadToCloudinary(file);
                }

                // Restore original upload zone
                uploadZone.innerHTML = originalHTML;

                // Reload gallery after upload
                setTimeout(() => {
                    loadPhotosFromCloudinary();
                }, 2000);

                fileInput.value = ''; // Reset input
            });

            // Load existing photos
            loadPhotosFromCloudinary();
        });

        // Upload file directly to Cloudinary
        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', UPLOAD_PRESET);

            // ‚úÖ Ensure uploads are discoverable via /image/list/rafstag.json
            // (Don‚Äôt rely on preset-side tagging unless you‚Äôve verified it.)
            formData.append('tags', 'rafstag');

            try {
                const response = await fetch(
                    `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
                    {
                        method: 'POST',
                        body: formData
                    }
                );

                const data = await response.json();

                if (data.secure_url) {
                    console.log('Upload successful:', data.secure_url);
                    addPhotoToGallery(data); // show immediately
                    return true;
                }

                if (data.error) {
                    console.error('Upload error:', data.error.message);
                    alert('Upload failed: ' + data.error.message);
                    return false;
                }

                console.error('Upload error: Unexpected response', data);
                alert('Upload failed: Unexpected response from Cloudinary');
                return false;
            } catch (error) {
                console.error('Upload failed:', error);
                alert('Upload failed. Please check your connection and try again.');
                return false;
            }
        }

        // Add photo to gallery immediately after upload
        function addPhotoToGallery(info) {
            const photoGrid = document.getElementById('photoGrid');
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            photoItem.innerHTML = `
                <img src="${info.secure_url}" alt="Stag photo" loading="lazy">
            `;
            photoGrid.insertBefore(photoItem, photoGrid.firstChild);
        }

        // Load all photos from Cloudinary using the tag
        async function loadPhotosFromCloudinary() {
            const photoGrid = document.getElementById('photoGrid');

            try {
                // Public tag-based JSON endpoint (note: Cloudinary may cache this list for a while)
                const response = await fetch(
                    `https://res.cloudinary.com/${CLOUD_NAME}/image/list/rafstag.json`,
                    { cache: 'no-store' } // avoids browser caching (CDN caching can still apply)
                );

                if (!response.ok) {
                    throw new Error(`List fetch failed: ${response.status}`);
                }

                const data = await response.json();
                photoGrid.innerHTML = ''; // Clear loading state

                if (data.resources && data.resources.length > 0) {
                    // Newest first if created_at exists; otherwise fall back to list order
                    const resources = [...data.resources].sort((a, b) => {
                        if (a.created_at && b.created_at) return b.created_at.localeCompare(a.created_at);
                        return 0;
                    });

                    resources.forEach(resource => {
                        const url =
                            `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/` +
                            `c_fill,h_400,w_400/v${resource.version}/${resource.public_id}.${resource.format}`;

                        const photoItem = document.createElement('div');
                        photoItem.className = 'photo-item';
                        photoItem.innerHTML = `
                            <img src="${url}" alt="Stag photo" loading="lazy">
                        `;
                        photoGrid.appendChild(photoItem);
                    });
                } else {
                    photoGrid.innerHTML =
                        '<p style="color: #888; text-align: center; width: 100%; padding: 40px 20px;">No photos yet. Be the first to upload!</p>';
                }
            } catch (error) {
                console.error('Error loading photos:', error);
                photoGrid.innerHTML = `
                    <p style="color:#888;text-align:center;width:100%;padding:40px 20px;">
                        Couldn‚Äôt load the shared gallery right now.<br><br>
                        Common causes:<br>
                        ‚Ä¢ The tag list is empty (uploads not tagged <strong>rafstag</strong>).<br>
                        ‚Ä¢ Cloudinary ‚ÄúResource List‚Äù is restricted in Security settings (list endpoint returns 401).<br>
                        ‚Ä¢ The tag list JSON may be cached for a while, so new uploads might not appear immediately.
                    </p>
                `;
            }
        }

        // Refresh photos every 30 seconds to show new uploads from others
        setInterval(loadPhotosFromCloudinary, 30000);
    </script>
</body>
</html>
